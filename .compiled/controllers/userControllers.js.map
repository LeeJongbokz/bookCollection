{"version":3,"sources":["../../src/controllers/userControllers.js"],"names":["home","req","res","render","getJoin","postJoin","next","body","email","password","user","User","register","bookShelfUrl","localStorage","setItem","redirect","routes","intro","console","log","join","getLogin","postLogin","passport","authenticate","failureRedirect","successRedirect","facebookLogin","failWithError","facebookLoginCallback","accessToken","refreshToken","profile","cb","postFacebookLogin","logout","flash","session","destroy","page1","myPage","myLibrary","bookPage","getIntro","postIntro","bookName","option","query","request","get","uri","qs","headers","Authorization","err","callbackRes","json","JSON","parse","documents","title","authors","book","Book","create","error","send"],"mappings":"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","sourcesContent":["import passport from \"passport\";\nimport routes from \"../routes\";\nimport User from \"../models/User\";\nimport Book from \"../models/Book\";\nimport localStorage from \"localStorage\";\nimport session from \"express-session\";\nimport { runInNewContext } from \"vm\";\nimport request from \"request\";\nimport querystring from \"query-string\";\n\n\nexport const home = (req, res) => res.render(\"home\");\n\nexport const getJoin = (req, res) => res.render(\"join\");\n   \nexport const postJoin = async(req, res, next) => {\n\n    const {\n        body: {email, password}\n    } = req;\n\n    try{        \n        const user = new User({\n            email,\n            password\n        })\n        \n        \n        await User.register(user, password);\n\n        user.bookShelfUrl = \"hello\";\n     \n        localStorage.setItem('tempbookShelfUrl', user.bookShelfUrl);\n    \n        res.redirect(routes.intro);\n\n\n    }catch(error){\n        console.log(error);\n        res.redirect(routes.join);\n    }\n}\n\nexport const getLogin = (req, res) => res.render(\"login\");\nexport const postLogin = passport.authenticate('local', {\n    failureRedirect: routes.home,\n    successRedirect: routes.intro\n}); \n\nexport const facebookLogin = passport.authenticate(\"facebook\", {failWithError: true});\n\nexport const facebookLoginCallback = (accessToken, refreshToken, profile, cb) =>{\n    console.log(accessToken, refreshToken, profile, cb);\n};\n\nexport const postFacebookLogin = (req, res) => {\n    res.redirect(routes.home);\n}\n\n\n\nexport const logout = (req, res) => {\n    req.flash(\"info\", \"Logged out, see you later\");\n    req.session.destroy();\n    req.logout();\n    res.redirect(routes.home);\n\n}\nexport const page1 = (req, res) => res.render(\"page1\");\nexport const myPage = (req, res) => res.render(\"mypage\");\nexport const myLibrary = (req, res) => res.render(\"mylibrary\");\n\nexport const bookPage = (req, res) => res.render(\"bookpage\");\n\n\nexport const getIntro = (req, res) => res.render(\"intro\");\nexport const postIntro = async(req, res) => {\n\n    const {\n        body: {bookName}\n    } = req;\n\n    const option = {\n        query : bookName\n    }\n    \n    let json;\n\n    request.get({\n        uri: \"https://dapi.kakao.com/v3/search/book?target=title\",\n        qs: option,\n        headers:{\n            Authorization: \"KakaoAK 78d32ce1cac5c4d2a998590338bef88d\"\n        }\n    }, function(err, callbackRes, body){\n        json = JSON.parse(body)\n        console.log(json.documents[0].title);\n        console.log(json.documents[0].authors);\n\n        let title = json.documents[0].title;\n        let authors = json.documents[0].authors;\n\n        try{\n            const book = Book.create({\n                title: title,\n                authors: authors\n            })\n\n            console.log(book);\n\n        }catch(error){\n            console.log(error);\n        }\n        res.send(title);\n\n    })\n\n    \n    \n}\n\n\n\n"],"file":"userControllers.js"}